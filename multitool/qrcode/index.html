<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>QRCode</title>
<link rel="icon" href="../../img/favicon.png" type="image/x-icon">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

<style>
  :root {
    --color-bg-light: #f4f6f9;
    --color-bg-dark: #121217;
    --color-primary-light: #5a4fcf;
    --color-primary-dark: #4865d6;
    --color-text-light: #333;
    --color-text-dark: #ddd;
    --shadow-subtle: rgba(90, 79, 207, 0.15);
    --shadow-dark: rgba(30, 30, 70, 0.6);
    --color-success: #27ae60;
    --color-fail: #e74c3c;
    --color-divider-light: #e0e0e0;
    --color-divider-dark: #2a2b35;
    --anim-curve: cubic-bezier(0.4, 0, 0.2, 1);
  }
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: var(--color-bg-light);
    color: var(--color-text-light);
    line-height: 1.6;
    padding: 24px;
    margin: 0;
    transition: background 0.3s, color 0.3s;
    overflow-x: hidden;
  }
  .dark-theme {
    background: var(--color-bg-dark);
    color: var(--color-text-dark);
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding-bottom: 22px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
  
  /* –®–ê–ü–ö–ê */
  header {
    color: white;
    padding: 20px 16px 20px 16px;
    text-align: center;
    border-radius: 12px;
    box-shadow: 0 4px 12px var(--shadow-subtle);
    transition: background 0.3s, background-image 0.3s;
    position: relative;
    
    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞: –ì—Ä–∞–¥–∏–µ–Ω—Ç (—Å–∏–Ω–∏–π -> —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π) + –£–∑–æ—Ä */
    background-color: var(--color-primary-light); 
    background-image: 
        linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%, rgba(255, 255, 255, 0.1)), 
        linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%, rgba(255, 255, 255, 0.1)),
        linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); /* –ì—Ä–∞–¥–∏–µ–Ω—Ç –ø–æ–¥–ª–æ–∂–∫–∞ */
    background-position: 0 0, 10px 10px, 0 0;
    background-size: 20px 20px, 20px 20px, 100% 100%;
    background-blend-mode: normal, normal, normal;
  }
  
  /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞: –†–µ–≤–µ—Ä—Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π -> —Å–∏–Ω–∏–π) */
  .dark-theme header {
    background-color: #3f3697;
    box-shadow: 0 4px 12px var(--shadow-dark);
    background-image: 
        linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%, rgba(255, 255, 255, 0.1)), 
        linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%, rgba(255, 255, 255, 0.1)),
        linear-gradient(135deg, #764ba2 0%, #667eea 100%); /* –†–µ–≤–µ—Ä—Å */
  }

  .header-title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
  }
  .header-title img { width: 40px; height: 40px; }
  header h1 { font-size: 26px; margin: 0; }

  /* –ö–Ω–æ–ø–∫–∞ "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä" (Arial) */
  .tab-switcher {
    display: inline-flex;
    background: rgba(0,0,0,0.15);
    border-radius: 25px;
    padding: 5px;
  }
  .tab-active {
      background: white;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 8px 20px;
      color: var(--color-primary-light);
      font-size: 16px;
      font-weight: 600;
      line-height: 1.2;
      cursor: default;
      font-family: Arial, sans-serif; /* Arial */
  }
  .dark-theme .tab-active {
      color: var(--color-primary-dark);
      background: #fff; 
  }

  .view-container h2 {
      text-align: center;
      font-size: 22px;
      color: var(--color-primary-light);
      margin-top: 30px;
      margin-bottom: 30px;
  }
  .dark-theme .view-container h2 {
      color: var(--color-primary-dark);
  }

  .main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 38px 40px;
    width: 100%;
    box-sizing: border-box;
    padding: 0;
  }
  
  /* –ë–ª–æ–∫–∏ */
  .params-block, .preview-block {
    background: #fff;
    border-radius: 12px;
    padding: 22px;
    box-shadow: 0 2px 8px var(--shadow-subtle);
    transition: background 0.3s, box-shadow 0.3s;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  .dark-theme .params-block,
  .dark-theme .preview-block {
    background: #1d1e27;
    box-shadow: 0 2px 8px rgba(90, 79, 207, 0.15);
  }

  /* FAQ SECTION: –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ - –°–ï–†–ï–ù–¨–ö–ò–ô –§–û–ù (#f4f6f9), –¢–µ–º–Ω–∞—è - —Ç–µ–º–Ω—ã–π (#1d1e27) */
  .faq-section {
    background: var(--color-bg-light); /* –°–µ—Ä–µ–Ω—å–∫–∏–π, –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω */
    border-radius: 12px;
    padding: 22px;
    box-shadow: 0 2px 8px var(--shadow-subtle);
    transition: background 0.3s, box-shadow 0.3s;
    width: 100%;
    box-sizing: border-box;
  }
  .dark-theme .faq-section {
    background: #1d1e27; /* –í —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ - –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –±–ª–æ–∫ */
    box-shadow: 0 2px 8px rgba(90, 79, 207, 0.15);
  }
  
  .form-group { margin-bottom: 17px; }
  label { display: block; margin-bottom: 6px; font-weight: 600; color: inherit; font-size: 16px; }
  
  input[type="text"],
  input[type="url"],
  select, textarea {
    width: 100%; padding: 10px; border: none; border-radius: 6px; font-size: 16px;
    box-sizing: border-box; background: var(--color-bg-light); color: var(--color-text-light);
    box-shadow: 0 0 6px rgb(90 79 207 / 0.1);
    transition: background 0.3s, color 0.3s;
  }
  .dark-theme input[type="text"],
  .dark-theme input[type="url"],
  .dark-theme select, .dark-theme textarea {
    background: #2a2b35; color: var(--color-text-dark);
    box-shadow: 0 0 6px rgba(90, 79, 207, 0.15);
  }
  
  /* Textarea –¥–ª—è –∫–æ–¥–∞ (—è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã) */
  textarea#seedArea {
      background: var(--color-bg-light);
      color: var(--color-text-light);
  }
  .dark-theme textarea#seedArea {
      background: #2a2b35;
      color: var(--color-text-dark);
  }

  .color-row { display: flex; gap: 15px; margin-bottom: 10px; }
  .color-wrap { 
    display: flex; align-items: center; gap: 10px; flex: 1;
    background: var(--color-bg-light); padding: 8px; border-radius: 6px; font-weight: 600;
  }
  .dark-theme .color-wrap { background: #2a2b35; }
  
  input[type="color"] { border: none; width: 30px; height: 30px; background: none; cursor: pointer; padding: 0; }

  .preview-block { align-items: center; }
  .preview-wrapper {
    display: flex; justify-content: center; align-items: center;
    margin-bottom: 20px; width: 100%; min-height: 300px;
  }
  #qrWrapper {
    background: #fff; padding: 15px; border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  
  .generate-btn {
    background: var(--color-primary-light); color: white; border: none;
    padding: 10px; border-radius: 7px; font-size: 15px; font-weight: 600;
    cursor: pointer; transition: background 0.3s; width: 100%;
    box-shadow: 0 4px 10px rgb(90 79 207 / 0.2);
  }
  .generate-btn:hover { background: var(--color-primary-dark); }
  .dark-theme .generate-btn { background: var(--color-primary-dark); }
  
  .copy-all {
    background: var(--color-primary-light); color: white; border: none;
    padding: 8px 15px; border-radius: 7px; font-size: 14px; cursor: pointer;
    font-weight: 500; box-shadow: 0 4px 10px rgb(90 79 207 / 0.2);
  }

  .divider { border: none; height: 1px; background-color: var(--color-divider-light); margin: 40px 0; }
  .dark-theme .divider { background-color: var(--color-divider-dark); }
  
  .faq-item { margin-bottom: 15px; }
  .faq-item:last-child { margin-bottom: 0; }
  .faq-item h3 { font-size: 18px; color: var(--color-primary-light); margin: 0 0 8px 0; }
  .dark-theme .faq-item h3 { color: var(--color-primary-dark); }
  .faq-item p { margin: 0; font-size: 15px; color: #777; }
  .dark-theme .faq-item p { color: #ccc; }

  footer { text-align: center; padding: 0 10px; color: #777; font-size: 14px; }
  
  .theme-toggle {
    position: fixed; bottom: 20px; right: 20px;
    background: var(--color-primary-light); border-radius: 50%;
    width: 41px; height: 41px; display: flex; justify-content: center; align-items: center;
    cursor: pointer; user-select: none; font-size: 19px;
    box-shadow: 0 3px 10px rgb(90 79 207 / 0.6);
    transition: background 0.3s, opacity 0.3s; z-index: 1000; opacity: 0.7; color: #fff;
  }
  .dark-theme .theme-toggle { background: var(--color-primary-dark); }
  .theme-toggle:hover { opacity: 1; }

  input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
    background: var(--color-primary-light); margin-top: -6px; cursor: pointer;
  }
  input[type=range]::-webkit-slider-runnable-track {
    width: 100%; height: 4px; background: #ccc; border-radius: 2px;
  }

  @media (max-width: 990px) {
    .main-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

  <div class="theme-toggle" id="theme-toggle">üí°</div>

  <div class="container">
    <header>
      <div class="header-title">
          <img src="../../img/logo.png" alt="Logo">
          <h1>QRCode</h1>
      </div>
      <div class="tab-switcher">
         <div class="tab-active">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</div>
      </div>
    </header>
    
    <div class="view-container active">
        <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR-–∫–æ–¥–æ–≤</h2>
        
        <div class="main-grid">
          
          <div class="params-block">
            <div class="form-group">
              <label>–°—Å—ã–ª–∫–∞ (URL)</label>
              <input type="url" id="urlInput" placeholder="https://example.com" value="https://example.com">
            </div>

            <div class="form-group">
              <label>–¶–≤–µ—Ç–∞</label>
              <div class="color-row">
                <div class="color-wrap">
                  <span>–§–æ–Ω</span>
                  <input type="color" id="bgColor" value="#ffffff">
                  <input type="text" id="bgColorHex" value="#ffffff" style="width:80px; padding:5px; font-size:14px;">
                </div>
                <div class="color-wrap">
                  <span>QR</span>
                  <input type="color" id="dotColor" value="#000000">
                  <input type="text" id="dotColorHex" value="#000000" style="width:80px; padding:5px; font-size:14px;">
                </div>
              </div>
              <label style="font-weight:normal; display:flex; align-items:center;">
                <input type="checkbox" id="bgTransparency" style="margin-right:8px;"> –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
              </label>
            </div>

            <div class="form-group">
               <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                 <div>
                   <label>–§–æ—Ä–º–∞ —Ç–æ—á–µ–∫</label>
                   <select id="dotShape">
                      <option value="square">–ö–≤–∞–¥—Ä–∞—Ç</option>
                      <option value="dots">–ö—Ä—É–≥</option>
                      <option value="classy">–°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ</option>
                      <option value="rounded">–ú—è–≥–∫–∏–µ</option>
                   </select>
                 </div>
                 <div>
                   <label>–£–≥–ª—ã</label>
                   <select id="markerShape">
                      <option value="square">–ö–≤–∞–¥—Ä–∞—Ç</option>
                      <option value="dot">–ö—Ä—É–≥</option>
                   </select>
                 </div>
               </div>
            </div>
            
            <div class="form-group">
               <label>–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –æ—à–∏–±–æ–∫</label>
               <select id="errorLevel">
                  <option value="L">Low (7%)</option>
                  <option value="M" selected>Medium (15%)</option>
                  <option value="Q">Quartile (25%)</option>
                  <option value="H">High (30%)</option>
               </select>
            </div>

            <div class="form-group">
              <label>–õ–æ–≥–æ—Ç–∏–ø</label>
              <input type="text" id="logoInput" placeholder="URL –ª–æ–≥–æ—Ç–∏–ø–∞" style="margin-bottom:10px;">
              
              <div style="position:relative; height:40px;">
                 <input type="file" id="logoFile" accept="image/*" style="position:absolute; width:100%; height:100%; opacity:0; cursor:pointer; z-index:2;">
                 <button class="copy-all" style="position:absolute; width:100%; height:100%; text-align:center; z-index:1;">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
              </div>

              <div id="logoPreviewBlock" style="display:none; margin-top:10px; position:relative; width:max-content;">
                <img id="logoPreview" style="height:50px; border-radius:4px; border:1px solid #ddd;">
                <button id="removeLogo" style="position:absolute; top:-8px; right:-8px; background:red; color:fff; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer;">√ó</button>
              </div>
              
              <img id="logoOverlay" style="display:none;">

              <div style="margin-top:15px;">
                <label style="font-weight:normal; font-size:14px;">–†–∞–∑–º–µ—Ä –ª–æ–≥–æ—Ç–∏–ø–∞</label>
                <input type="range" id="logoSize" min="1" max="25" value="15">
              </div>
            </div>
          </div>

          <div class="preview-block">
             <div style="color:var(--color-primary-light); font-weight:600; margin-bottom:20px; font-size:18px;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
             
             <div class="preview-wrapper">
                 <div id="qrWrapper">
                   <div id="qr-code"></div>
                 </div>
             </div>

             <div id="exportButtons" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width:100%; margin-bottom:20px;">
                <button class="generate-btn" data-type="png">PNG</button>
                <button class="generate-btn" data-type="svg">SVG</button>
                <button class="generate-btn" data-type="jpg">JPG</button>
                <button class="generate-btn" data-type="pdf">PDF</button>
             </div>
             
             <div style="width:100%; border-top:1px solid #eee; padding-top:15px;">
                <label style="font-size:14px; margin-bottom:5px;">–ö–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞</label>
                <textarea id="seedArea" style="width:100%; height:60px; border:none; resize:none; border-radius:6px; padding:10px; font-size:12px; font-family:monospace;" placeholder="Base64 –∫–æ–¥"></textarea>
                <div style="display:flex; gap:10px; margin-top:10px;">
                  <button class="copy-all" id="copySettings">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                  <button class="copy-all" id="loadSettingsBtn">–í—Å—Ç–∞–≤–∏—Ç—å</button>
                </div>
             </div>
          </div>

        </div>
    </div>
    
    <hr class="divider">
    
    <div class="faq-section">
        <div class="faq-item">
            <h3>–î–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR-–∫–æ–¥–æ–≤?</h3>
            <p>–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å QR-–∫–æ–¥—ã –¥–ª—è —Å—Å—ã–ª–æ–∫, —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –≤–∏–∑–∏—Ç–æ–∫. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–≤–µ—Ç, —Ñ–æ—Ä–º—É —Ç–æ—á–µ–∫ –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ª–æ–≥–æ—Ç–∏–ø.</p>
        </div>
        <div class="faq-item">
            <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —ç—Ç–æ?</h3>
            <p>–ê–±—Å–æ–ª—é—Ç–Ω–æ. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç <strong>–ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</strong>. –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
        </div>
        <div class="faq-item">
            <h3>–ö–∞–∫ —Å—á–∏—Ç–∞—Ç—å QR-–∫–æ–¥?</h3>
            <p>–ü—Ä–æ—Å—Ç–æ –Ω–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –≤–∞—à–µ–≥–æ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã (iOS –∏ Android) —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç –∫–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
        </div>
    </div>

    <hr class="divider">
    
    <footer>
        &copy; 2025 QRCode. –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
    </footer>
  </div>

  <div id="messageBox" style="position:fixed; bottom:20px; left:20px; background:#333; color:#fff; padding:10px 20px; border-radius:20px; opacity:0; pointer-events:none; transition:0.3s; z-index:2000;"></div>

  <script>
    const toggleBtn = document.getElementById('theme-toggle');
    const bodyEl = document.body;
    
    if(localStorage.getItem('theme') === 'dark') {
      bodyEl.classList.add('dark-theme');
    }

    toggleBtn.addEventListener('click', () => {
      bodyEl.classList.toggle('dark-theme');
      localStorage.setItem('theme', bodyEl.classList.contains('dark-theme') ? 'dark' : 'light');
    });

    document.addEventListener('DOMContentLoaded', () => {
      const qrCode = new QRCodeStyling({
        width: 300, height: 300, type: "svg", data: "https://example.com",
        dotsOptions: { color: "#000000", type: "square" },
        cornersSquareOptions: { type: "square", color: "#000000" },
        cornersDotOptions: { type: "dot", color: "#000000" },
        backgroundOptions: { color: "#ffffff" },
        margin: 5, qrOptions: { errorCorrectionLevel: "M" }
      });
      const container = document.getElementById("qr-code");
      qrCode.append(container);

      const urlInput = document.getElementById("urlInput");
      const dotColor = document.getElementById("dotColor");
      const dotColorHex = document.getElementById("dotColorHex");
      const bgColor = document.getElementById("bgColor");
      const bgColorHex = document.getElementById("bgColorHex");
      const bgTransparency = document.getElementById("bgTransparency");
      const dotShape = document.getElementById("dotShape");
      const markerShape = document.getElementById("markerShape");
      const logoInput = document.getElementById("logoInput");
      const logoFile = document.getElementById("logoFile");
      const logoPreview = document.getElementById("logoPreview");
      const removeLogoBtn = document.getElementById("removeLogo");
      const logoSize = document.getElementById("logoSize");
      const errorLevel = document.getElementById("errorLevel");
      const seedArea = document.getElementById("seedArea");
      const copySettingsBtn = document.getElementById("copySettings");
      const loadSettingsBtn = document.getElementById("loadSettingsBtn");
      const messageBox = document.getElementById("messageBox");

      let logoData = "";
      let updateTimer;

      function showMessage(msg) {
        messageBox.textContent = msg;
        messageBox.style.opacity = "1";
        setTimeout(() => { messageBox.style.opacity = "0"; }, 2500);
      }

      function syncColorInputs(colorInput, hexInput) {
        colorInput.addEventListener("input", () => {
          hexInput.value = colorInput.value;
          delayedUpdateQR();
        });
        hexInput.addEventListener("input", () => {
          const val = hexInput.value.trim();
          if (/^#([0-9A-Fa-f]{6})$/.test(val)) {
            colorInput.value = val;
            delayedUpdateQR();
          }
        });
      }
      syncColorInputs(dotColor, dotColorHex);
      syncColorInputs(bgColor, bgColorHex);

      function updateLogoDisplay() {
        if (logoData) {
          logoPreview.src = logoData;
          document.getElementById("logoPreviewBlock").style.display = "block";
          logoInput.style.display = "none";
        } else {
          document.getElementById("logoPreviewBlock").style.display = "none";
          logoInput.style.display = "block";
        }
      }

      function updateQR() {
        const data = urlInput.value.trim();
        const sizePercent = Math.min(Math.max(parseFloat(logoSize.value) || 15, 1), 25);
        
        qrCode.update({
          data: data || "",
          dotsOptions: { color: dotColor.value, type: dotShape.value },
          cornersSquareOptions: { type: markerShape.value, color: dotColor.value },
          cornersDotOptions: { type: markerShape.value, color: dotColor.value },
          backgroundOptions: { color: bgTransparency.checked ? "transparent" : bgColor.value },
          qrOptions: { errorCorrectionLevel: errorLevel.value },
          image: logoData,
          imageOptions: { hideBackgroundDots: true, imageSize: sizePercent / 25, margin: 0 }
        });

        updateLogoDisplay();

        const settings = {
          data, dotColor: dotColor.value, dotColorHex: dotColorHex.value,
          bgColor: bgColor.value, bgColorHex: bgColorHex.value,
          bgTransparency: bgTransparency.checked, dotShape: dotShape.value,
          markerShape: markerShape.value, logoUrl: logoInput.value,
          logoBase64: logoData, logoSize: logoSize.value, errorLevel: errorLevel.value
        };
        seedArea.value = btoa(JSON.stringify(settings));
      }

      function delayedUpdateQR() {
        clearTimeout(updateTimer);
        updateTimer = setTimeout(updateQR, 300);
      }

      urlInput.addEventListener("input", delayedUpdateQR);
      logoInput.addEventListener("input", delayedUpdateQR);
      
      logoFile.addEventListener("change", () => {
        const file = logoFile.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = e => {
          logoData = e.target.result || "";
          logoInput.value = "";
          delayedUpdateQR();
        };
        reader.readAsDataURL(file);
      });

      removeLogoBtn.addEventListener("click", () => {
        logoData = ""; logoInput.value = ""; logoFile.value = "";
        delayedUpdateQR();
      });

      logoSize.addEventListener("input", delayedUpdateQR);
      bgTransparency.addEventListener("change", delayedUpdateQR);
      dotShape.addEventListener("change", delayedUpdateQR);
      markerShape.addEventListener("change", delayedUpdateQR);
      errorLevel.addEventListener("change", delayedUpdateQR);

      copySettingsBtn.addEventListener("click", () => {
        seedArea.select();
        document.execCommand("copy");
        showMessage("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã");
      });

      loadSettingsBtn.addEventListener("click", () => {
        try {
          const settings = JSON.parse(atob(seedArea.value));
          urlInput.value = settings.data || "";
          dotColor.value = settings.dotColor || "#000000";
          dotColorHex.value = settings.dotColorHex || "#000000";
          bgColor.value = settings.bgColor || "#ffffff";
          bgColorHex.value = settings.bgColorHex || "#ffffff";
          bgTransparency.checked = settings.bgTransparency || false;
          dotShape.value = settings.dotShape || "square";
          markerShape.value = settings.markerShape || "square";
          logoData = settings.logoBase64 || "";
          logoSize.value = settings.logoSize || 15;
          errorLevel.value = settings.errorLevel || "M";
          delayedUpdateQR();
          showMessage("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
        } catch {
          showMessage("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏");
        }
      });

      document.getElementById("exportButtons").querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          const ext = btn.getAttribute("data-type");
          qrCode.download({ extension: ext, name: "qr-code" });
        });
      });

      delayedUpdateQR();
    });
  </script>

</body>
</html>
