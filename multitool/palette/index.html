<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Palette</title>
<link rel="icon" href="../../img/favicon.png" type="image/x-icon">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">

<!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –ø–∞–ª–∏—Ç—Ä—ã -->
<script src="https://cdn.jsdelivr.net/npm/colorthief@2.3.0/dist/color-thief.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  :root {
    --color-bg-light: #f4f6f9;
    --color-bg-dark: #121217;
    --color-primary-light: #5a4fcf;
    --color-primary-dark: #4865d6;
    --color-text-light: #333;
    --color-text-dark: #ddd;
    --shadow-subtle: rgba(90, 79, 207, 0.15);
    --shadow-dark: rgba(30, 30, 70, 0.6);
    --color-success: #27ae60;
    --color-divider-light: #e0e0e0;
    --color-divider-dark: #2a2b35;
    --anim-curve: cubic-bezier(0.4, 0, 0.2, 1);
  }
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: var(--color-bg-light);
    color: var(--color-text-light);
    line-height: 1.6;
    padding: 24px;
    margin: 0;
    transition: background 0.3s, color 0.3s;
    overflow-x: hidden;
  }
  .dark-theme {
    background: var(--color-bg-dark);
    color: var(--color-text-dark);
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding-bottom: 22px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
  
  /* --- –®–ê–ü–ö–ê --- */
  header {
    color: white;
    padding: 20px 16px 20px 16px;
    text-align: center;
    border-radius: 12px;
    box-shadow: 0 4px 12px var(--shadow-subtle);
    transition: background 0.3s;
    position: relative;
    
    background-color: var(--color-primary-light);
    background-image: linear-gradient(
      45deg, 
      rgba(72, 101, 214, 0.4) 25%, 
      transparent 25%, 
      transparent 50%, 
      rgba(72, 101, 214, 0.4) 50%, 
      rgba(72, 101, 214, 0.4) 75%, 
      transparent 75%, 
      transparent
    );
    background-size: 20px 20px;
  }
  
  .dark-theme header {
    background-color: var(--color-primary-dark);
    background-image: linear-gradient(
      45deg, 
      rgba(90, 79, 207, 0.4) 25%, 
      transparent 25%, 
      transparent 50%, 
      rgba(90, 79, 207, 0.4) 50%, 
      rgba(90, 79, 207, 0.4) 75%, 
      transparent 75%, 
      transparent
    );
  }

  .back-btn {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 15px;
    border-radius: 20px;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .back-btn:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .header-title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
  }
  .logo-link {
    display: flex;
    align-items: center;
    text-decoration: none;
  }
  .logo-link img { 
    width: 40px; 
    height: 40px; 
    transition: transform 0.3s;
  }
  .logo-link:hover img {
    transform: scale(1.05);
  }
  
  header h1 { font-size: 26px; margin: 0; }

  .tab-switcher {
    display: inline-flex;
    background: rgba(0,0,0,0.15);
    border-radius: 25px;
    padding: 5px;
  }
  .tab-active {
      background: white;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 8px 20px;
      color: var(--color-primary-light);
      font-size: 16px;
      font-weight: 600;
      line-height: 1.2;
      cursor: default;
      font-family: Arial, sans-serif;
  }
  .dark-theme .tab-active {
      color: var(--color-primary-dark);
      background: #fff; 
  }

  .view-container h2 {
      text-align: center;
      font-size: 22px;
      color: var(--color-primary-light);
      margin-top: 30px;
      margin-bottom: 30px;
  }
  .dark-theme .view-container h2 {
      color: var(--color-primary-dark);
  }

  .main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 38px 40px;
    width: 100%;
    box-sizing: border-box;
    padding: 0;
    margin-bottom: 30px;
  }
  
  /* –ë–ï–õ–´–ï –ë–õ–û–ö–ò –ò FAQ –°–ï–ö–¶–ò–Ø */
  .white-block, .faq-section {
    background: #fff;
    border-radius: 12px;
    padding: 22px;
    box-shadow: 0 2px 8px var(--shadow-subtle);
    transition: background 0.3s, box-shadow 0.3s;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  .dark-theme .white-block,
  .dark-theme .faq-section {
    background: #1d1e27;
    box-shadow: 0 2px 8px rgba(90, 79, 207, 0.15);
  }
  
  /* FAQ - –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –¶–í–ï–¢–ê –§–û–ù–ê (–Ω–æ —Ç–µ–Ω—å –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç –æ–±—â–µ–≥–æ —Å—Ç–∏–ª—è –≤—ã—à–µ) */
  .faq-section {
    background: var(--color-bg-light); 
  }
  .dark-theme .faq-section {
    background: #1d1e27;
  }
  
  .block-title {
    color: var(--color-primary-light);
    font-weight: 600;
    font-size: 18px;
    margin-bottom: 20px;
    text-align: left;
  }
  .dark-theme .block-title {
    color: var(--color-primary-light); 
  }
  
  .divider { 
      border: none; 
      height: 1px; 
      background-color: var(--color-divider-light); 
      margin: 40px 0; 
  }
  .dark-theme .divider { 
      background-color: var(--color-divider-dark); 
  }
  
  .faq-item { margin-bottom: 15px; }
  .faq-item:last-child { margin-bottom: 0; }
  .faq-item h3 { font-size: 18px; color: var(--color-primary-light); margin: 0 0 8px 0; }
  .dark-theme .faq-item h3 { color: var(--color-primary-dark); }
  .faq-item p { margin: 0; font-size: 15px; color: #777; }
  .dark-theme .faq-item p { color: #ccc; }

  footer { text-align: center; padding: 0 10px; color: #777; font-size: 14px; }
  
  .theme-toggle {
    position: fixed; bottom: 20px; left: 20px;
    background: var(--color-primary-light); border-radius: 50%;
    width: 41px; height: 41px; display: flex; justify-content: center; align-items: center;
    cursor: pointer; user-select: none; font-size: 19px;
    box-shadow: 0 3px 10px rgb(90 79 207 / 0.6);
    transition: background 0.3s, opacity 0.3s; z-index: 1000; opacity: 0.7; color: #fff;
  }
  .dark-theme .theme-toggle { background: var(--color-primary-dark); }
  .theme-toggle:hover { opacity: 1; }

  /* === –°–¢–ò–õ–ò –î–õ–Ø PALETTE === */

  .drop-area {
    position: relative;
    width: 100%;
    height: 180px;
    border: 2px dashed var(--color-divider-light);
    border-radius: 12px;
    box-sizing: border-box; 
    padding: 20px;
    text-align: center;
    background: var(--color-bg-light);
    color: var(--color-text-light);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
    overflow: hidden;
  }

  .dark-theme .drop-area {
    background: #2a2b35;
    border-color: var(--color-divider-dark);
    color: var(--color-text-dark);
  }

  .drop-area:hover {
    border-color: var(--color-primary-light);
    transform: translateY(-2px);
  }
  .dark-theme .drop-area:hover {
    border-color: var(--color-primary-dark);
  }

  .drop-area.active {
    border-color: var(--color-success);
    color: var(--color-success);
    background: rgba(39, 174, 96, 0.1);
  }

  .drop-area input {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    opacity: 0; cursor: pointer; z-index: 2;
  }

  .drop-icon { font-size: 40px; opacity: 0.8; }
  .drop-text { font-size: 16px; font-weight: 600; margin: 0; }
  .drop-subtext { font-size: 13px; color: #888; margin: 0; }

  #preview {
    margin: 0;
    width: 100%;
    text-align: center;
    height: 180px; 
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-bg-light);
    border-radius: 12px;
    border: 1px solid transparent;
    overflow: hidden;
  }
  .dark-theme #preview {
    background: #2a2b35;
  }

  #preview img {
    max-width: 100%;
    max-height: 180px; 
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    object-fit: contain;
  }
  #preview:empty::before {
    content: '–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è';
    color: #999;
    font-size: 14px;
  }

  #palette {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
    width: 100%;
  }

  .color-block {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .swatch {
    width: 70px;
    height: 70px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 12px;
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.6);
    transition: transform 0.2s ease;
    position: relative;
  }

  .swatch::after {
    content: attr(data-hex);
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    background: #1f2937;
    color: white;
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 6px;
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s;
    pointer-events: none;
    z-index: 10;
  }
  .swatch:hover::after { opacity: 1; }
  .swatch:hover { transform: scale(1.1); z-index: 5; }

  .shades { display: flex; gap: 5px; }
  .shade {
    width: 16px; height: 16px;
    border-radius: 50%;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.15s;
  }
  .shade:hover { transform: scale(1.3); }

  .actions-grid {
     display: grid;
     grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
     gap: 15px;
     width: 100%;
     justify-content: center;
  }

  .generate-btn {
    background: var(--color-primary-light);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 7px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s, transform 0.1s;
    box-shadow: 0 4px 10px rgb(90 79 207 / 0.2);
    text-align: center;
    white-space: nowrap;
  }
  .generate-btn:hover { background: var(--color-primary-dark); }
  .generate-btn:active { transform: translateY(1px); }
  .dark-theme .generate-btn { background: var(--color-primary-dark); }
  
  #messageBox {
    position:fixed; bottom:20px; right:20px; 
    background: var(--color-success); 
    color:#fff; padding:10px 20px; 
    border-radius: 20px; 
    opacity:0; pointer-events:none; 
    transition:0.3s; z-index:2000;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  @media (max-width: 990px) {
    .main-grid { grid-template-columns: 1fr; gap: 20px; }
    .back-btn {
        position: relative; left: auto; top: auto;
        transform: none; display: inline-block; margin-bottom: 10px;
    }
    .drop-area { height: 140px; }
  }
</style>
</head>
<body>

  <div class="theme-toggle" id="theme-toggle">üí°</div>

  <div class="container">
    <header>
      <a href="https://zvarichenkodaria.ru/multitool" class="back-btn">‚Üê –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a>
      
      <div class="header-title">
          <a href="https://zvarichenkodaria.ru" class="logo-link" target="_blank">
            <img src="../../img/logo.png" alt="Logo">
          </a>
          <h1>Palette</h1>
      </div>
      <div class="tab-switcher">
         <div class="tab-active">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</div>
      </div>
    </header>
    
    <div class="view-container active">
        <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ü–≤–µ—Ç–æ–≤–æ–π –ø–∞–ª–∏—Ç—Ä—ã</h2>
        
        <div class="main-grid">
          <div class="white-block">
            <div class="block-title">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
            <div class="drop-area" id="drop-area">
               <input type="file" id="file-input" accept="image/*" />
               <div class="drop-icon">üñºÔ∏è</div>
               <div class="drop-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ</div>
               <div class="drop-subtext">JPG, PNG, WEBP ‚Äî –¥–æ 10 –ú–ë</div>
            </div>
          </div>

          <div class="white-block">
             <div class="block-title">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
             <div id="preview"></div>
          </div>
        </div>

        <div class="white-block" id="result-block">
            <div class="block-title">–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</div>
            <div id="palette">
                 <div style="color: #999; font-style: italic; width: 100%; text-align: center;">
                    –¶–≤–µ—Ç–∞ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏...
                 </div>
            </div>

            <div class="actions-grid">
               <button id="copy-css" class="generate-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å CSS</button>
               <button id="save-json" class="generate-btn">–°–∫–∞—á–∞—Ç—å JSON</button>
               <button id="export-txt" class="generate-btn">–≠–∫—Å–ø–æ—Ä—Ç TXT</button>
               <button id="export-png" class="generate-btn">–≠–∫—Å–ø–æ—Ä—Ç PNG</button>
            </div>
        </div>
    </div>
    
    <hr class="divider">
    
    <div class="faq-section">
        <div class="faq-item">
            <h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
            <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–∏–∫—Å–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤—ã–¥–µ–ª—è–µ—Ç 6 –¥–æ–º–∏–Ω–∏—Ä—É—é—â–∏—Ö —Ü–≤–µ—Ç–æ–≤, —Å–æ–∑–¥–∞–≤–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–≤–µ—Ç–ª—ã–µ –∏ —Ç–µ–º–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏.</p>
        </div>
        <div class="faq-item">
            <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —ç—Ç–æ?</h3>
            <p>–î–∞. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç <strong>–ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</strong>. –í–∞—à–∏ —Ñ–æ—Ç–æ –Ω–∏–∫—É–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è.</p>
        </div>
        <div class="faq-item">
            <h3>–ó–∞—á–µ–º –Ω—É–∂–Ω—ã –æ—Ç—Ç–µ–Ω–∫–∏?</h3>
            <p>–ú–∞–ª–µ–Ω—å–∫–∏–µ –∫—Ä—É–∂–∫–∏ —Ä—è–¥–æ–º —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ü–≤–µ—Ç–æ–º ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ (—Å–≤–µ—Ç–ª–µ–µ/—Ç–µ–º–Ω–µ–µ), –ø–æ–ª–µ–∑–Ω—ã–µ –¥–ª—è UI-–¥–∏–∑–∞–π–Ω–∞ (—Ö–æ–≤–µ—Ä—ã, –±–æ—Ä–¥–µ—Ä—ã).</p>
        </div>
    </div>

    <hr class="divider">
    
    <footer>
        &copy; 2025 Palette Generator. –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
    </footer>
  </div>

  <div id="messageBox">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

  <script>
    // === –õ–û–ì–ò–ö–ê –¢–ï–ú–´ ===
    const toggleBtn = document.getElementById('theme-toggle');
    const bodyEl = document.body;
    
    if(localStorage.getItem('theme') === 'dark') {
      bodyEl.classList.add('dark-theme');
    }

    toggleBtn.addEventListener('click', () => {
      bodyEl.classList.toggle('dark-theme');
      localStorage.setItem('theme', bodyEl.classList.contains('dark-theme') ? 'dark' : 'light');
    });

    // === –õ–û–ì–ò–ö–ê –ü–ê–õ–ò–¢–†–´ ===
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const preview = document.getElementById('preview');
    const palette = document.getElementById('palette');
    const copyCssBtn = document.getElementById('copy-css');
    const exportPngBtn = document.getElementById('export-png');
    const saveJsonBtn = document.getElementById('save-json');
    const exportTxtBtn = document.getElementById('export-txt');
    const messageBox = document.getElementById('messageBox');
    const colorThief = new ColorThief();
    
    let fullPalette = [];

    function showMessage(msg) {
        messageBox.textContent = msg;
        messageBox.style.opacity = "1";
        setTimeout(() => { messageBox.style.opacity = "0"; }, 2000);
    }

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (file) handleFile(file);
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
      dropArea.addEventListener(e, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(e => {
      dropArea.addEventListener(e, () => dropArea.classList.add('active'), false);
    });

    ['dragleave', 'drop'].forEach(e => {
      dropArea.addEventListener(e, () => dropArea.classList.remove('active'), false);
    });

    dropArea.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const file = dt.files[0];
      if (file && file.type.startsWith('image/')) {
        fileInput.files = dt.files;
        handleFile(file);
      }
    });

    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = () => {
          preview.innerHTML = '';
          preview.appendChild(img);
          setTimeout(() => extractColors(img), 100);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function extractColors(img) {
      try {
        const paletteData = colorThief.getPalette(img, 6);
        fullPalette = paletteData.map(rgb => {
          const hex = rgbToHex(rgb);
          const shades = [];
          for (let i = -2; i <= 2; i++) {
             if (i === 0) continue;
             shades.push(adjustColor(hex, i * 20));
          }
          return { main: hex, shades: shades }; 
        });
        
        renderPalette(fullPalette);
      } catch (err) {
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ');
        console.error(err);
      }
    }

    function renderPalette(data) {
      palette.innerHTML = '';
      data.forEach(item => {
        const block = document.createElement('div');
        block.className = 'color-block';

        // Main
        const swatch = document.createElement('div');
        swatch.className = 'swatch';
        swatch.style.backgroundColor = item.main;
        swatch.dataset.hex = item.main;
        swatch.textContent = item.main.toUpperCase();
        swatch.addEventListener('click', () => {
          navigator.clipboard.writeText(item.main);
          showMessage('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + item.main);
        });

        // Shades
        const shadesDiv = document.createElement('div');
        shadesDiv.className = 'shades';
        item.shades.forEach(shadeHex => {
           const shade = document.createElement('div');
           shade.className = 'shade';
           shade.style.backgroundColor = shadeHex;
           shade.title = shadeHex;
           shade.addEventListener('click', () => {
             navigator.clipboard.writeText(shadeHex);
             showMessage('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + shadeHex);
           });
           shadesDiv.appendChild(shade);
        });

        block.appendChild(swatch);
        block.appendChild(shadesDiv);
        palette.appendChild(block);
      });
    }

    copyCssBtn.addEventListener('click', () => {
      if (!fullPalette.length) { showMessage('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ'); return; }
      let css = ':root {\n';
      fullPalette.forEach((item, idx) => {
         const n = idx + 1;
         css += `  /* Color ${n} */\n`;
         css += `  --color-${n}: ${item.main};\n`;
         css += `  --color-${n}-dark-2: ${item.shades[0]};\n`;
         css += `  --color-${n}-dark-1: ${item.shades[1]};\n`;
         css += `  --color-${n}-light-1: ${item.shades[2]};\n`;
         css += `  --color-${n}-light-2: ${item.shades[3]};\n\n`;
      });
      css += '}';
      navigator.clipboard.writeText(css);
      showMessage('CSS (–≤—Å–µ –æ—Ç—Ç–µ–Ω–∫–∏) —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    });

    saveJsonBtn.addEventListener('click', () => {
      if (!fullPalette.length) return;
      const data = JSON.stringify({
        palette: fullPalette,
        generatedAt: new Date().toISOString()
      }, null, 2);
      downloadFile(data, 'palette.json', 'application/json');
      showMessage('JSON —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
    });

    exportTxtBtn.addEventListener('click', () => {
       if (!fullPalette.length) return;
       let txt = 'PALETTE EXPORT\n================\n\n';
       fullPalette.forEach((item, idx) => {
          txt += `COLOR ${idx + 1}: ${item.main}\n`;
          txt += `  Darker:  ${item.shades[0]}\n`;
          txt += `  Dark:    ${item.shades[1]}\n`;
          txt += `  Light:   ${item.shades[2]}\n`;
          txt += `  Lighter: ${item.shades[3]}\n`;
          txt += '----------------\n';
       });
       downloadFile(txt, 'palette.txt', 'text/plain');
       showMessage('TXT —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
    });

    exportPngBtn.addEventListener('click', () => {
      if (!fullPalette.length) return;
      const bg = getComputedStyle(document.body).backgroundColor;
      const paletteBlock = document.getElementById('result-block');
      html2canvas(paletteBlock, { backgroundColor: bg, scale: 2 })
        .then(canvas => {
          const url = canvas.toDataURL('image/png');
          const a = document.createElement('a');
          a.href = url;
          a.download = 'palette.png';
          a.click();
        });
      showMessage('PNG —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...');
    });

    function downloadFile(content, filename, type) {
       const blob = new Blob([content], { type: type });
       const url = URL.createObjectURL(blob);
       const a = document.createElement('a');
       a.href = url;
       a.download = filename;
       a.click();
       URL.revokeObjectURL(url);
    }

    function rgbToHex(color) {
      if (typeof color === 'string') return color;
      const [r, g, b] = color;
      return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
    }

    function adjustColor(hex, percent) {
      const num = parseInt(hex.replace('#', ''), 16);
      const r = Math.max(0, Math.min(255, (num >> 16) + percent));
      const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + percent));
      const b = Math.max(0, Math.min(255, (num & 0x0000FF) + percent));
      return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
    }
  </script>

</body>
</html>
